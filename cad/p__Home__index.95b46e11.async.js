"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{61253:function(ea,ye,h){h.r(ye),h.d(ye,{default:function(){return Jt}});var Me=h(5574),A=h.n(Me),L=h(67294),u=h(25185),Ue=h(19632),Se=h.n(Ue),p=h(85975);function fe(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[1,0,0],r=-n/2,s=n/a,o=[],l=[],d=0;d<Math.floor(a/2);d++)o.push(r,0,0,r+s,0,0),l.push.apply(l,Se()(t).concat(Se()(t))),r+=s*2;var m=new u.mqh("aVertex",3,new Float32Array(o)),v=new u.mqh("aColor",3,new Float32Array(l)),g=new u.BKN("lines",0,Math.floor(a/2)*2),f=new u.ZXM;return f.push(m),f.push(v),f.push(g),f}function Ae(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:40,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:50,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=fe(a,n,[1,0,0]),s=fe(a,n,[0,1,0]),o=fe(a,n,[0,0,1]),l=new u.O3I;l.vertexCompiler.assemblePosition(),l.vertexCompiler.attributeQualifier.set("aColor","vec3"),l.vertexCompiler.varyingQualifier.set("vColor","vec3"),l.vertexCompiler.attach("vColor = aColor;"),l.fragmentCompiler.varyingQualifier.set("vColor","vec3"),l.fragmentCompiler.attach("color = vec4(vColor,1.0);"),l.states.add(new u.bKI(!0));var d=l.generate(),m=new u.QuO;m.push(r),m.push(d);var v=new u.QuO(new u.wx7(p.QO(p.Ue(),Math.PI/2)));v.push(s),v.push(d);var g=new u.QuO(new u.wx7(p.gT(p.Ue(),Math.PI/2)));g.push(o),g.push(d);var f=new u.Lzx;return f.addDrawable(m),f.addDrawable(v),f.addDrawable(g),f.selectable=t,f}var P=h(77160);function Be(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,n=new u.Q$L(a,a),t=new u.mqh("aVertex",3,n.vertices),r=new u.mqh("aNormal",3,n.normals),s=new u.bsW(n.indices),o=new u.xNV("triangles",n.indices.length,"unsigned_short",0),l=new u.ZXM;return l.push(t),l.push(r),l.push(s),l.push(o),l}function Ve(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=Be(a),r=new u.O3I;r.vertexCompiler.assemblePosition(),r.fragmentCompiler.attach("color = vec4(0.1, 0.1, 0.1, 0.4);"),r.states.add(new u.adS(!0)),r.states.add(new u.bKI(!0,"less",!1)),r.isTransparent=!0;var s=r.generate();s.push(new u.XHd(!0,1,1));var o=new u.QuO;o.push(t),o.push(s);var l=new u.QuO(new u.wx7(p.aC(p.Ue(),Math.PI/2)));l.push(t),l.push(s);var d=new u.QuO(new u.wx7(p.QO(p.Ue(),Math.PI/2)));d.push(t),d.push(s);var m=new u.Lzx;m.addDrawable(o),m.selectable=n;var v=new u.Lzx;v.addDrawable(l),v.selectable=n;var g=new u.Lzx;g.addDrawable(d),g.selectable=n;var f=new u.JJg;return f.addPart(m),f.addPart(v),f.addPart(g),p.bA(f.transform.matrix,f.transform.matrix,[5,5,5]),f}function Re(){var a=new u.mqh("aVertex",3,new Float32Array([1,1,0,1,-1,0,-1,-1,0,-1,1,0])),n=new u.BKN("line_loop",0,4),t=new u.ZXM;t.push(a),t.push(n);var r=new u.O3I;r.vertexCompiler.assemblePosition(),r.fragmentCompiler.attach("color = vec4(1, 1, 0.1, 1);");var s=p.Ue(),o=new u.QuO(new u.wx7(p.bA(s,s,P.al(25,25,25))));o.push(t);var l=r.generate();l.push(new u.XHd(!0,1,1)),o.push(l);var d=new u.Lzx(o);return d.selectable=!1,d}var ke=u.H6O.createLightColor(new u.Ilk(1,.925,.545)),Pe=ke.generate();function T(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,l=arguments.length>6?arguments[6]:void 0,d=new u.D2c(a,n,t,r,s,o),m=new u.mqh("aVertex",3,d.vertices);l&&u.z2$(m,l);var v=new u.mqh("aNormal",3,d.normals),g=new u.bsW(d.indices),f=new u.xNV("triangles",d.indices.length,"unsigned_short",0),x=new u.ZXM;x.push(m),x.push(v),x.push(g),x.push(f);var w=new u.QuO;return w.push(x),w.push(Pe),w}function q(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0,d=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Math.PI*2,m=new u.o1z(a,n,t,r,s,o,l,d),v=new u.mqh("aVertex",3,m.vertices);u.z2$(v,p.aC(p.Ue(),Math.PI/2));var g=new u.mqh("aNormal",3,m.normals),f=new u.bsW(m.indices),x=new u.xNV("triangles",m.indices.length,"unsigned_short",0),w=new u.ZXM;w.push(v),w.push(g),w.push(f),w.push(x);var M=new u.QuO;return M.push(w),M.push(Pe),M}var He=h(12444),k=h.n(He),Oe=h(72004),H=h.n(Oe),Le=h(9783),b=h.n(Le),Ne=function(){function a(n){k()(this,a),b()(this,"m_buildInUniforms",void 0),b()(this,"m_action",void 0),b()(this,"m_type","none"),this.m_buildInUniforms=n}return H()(a,[{key:"action",get:function(){return this.m_action}},{key:"render",value:function(){}},{key:"begin",value:function(t,r){switch(t){case"pan":this.m_action=new u.swj(this.m_buildInUniforms,r),this.m_type=t;break;case"orbit":this.m_action=new u.YAP(this.m_buildInUniforms,r),this.m_type=t;break}(t==="pan"||t==="orbit")&&this.render()}},{key:"move",value:function(t){this.m_action&&(this.m_action.update(t),this.render())}},{key:"end",value:function(t){this.m_action&&(this.m_action=void 0,this.m_type="none",this.render())}}]),a}(),W=function(a){return a.CornerBolted="\u89D2\u7801\u6813\u63A5",a.PlateBolted="\u710A\u677F\u6813\u63A5",a.HingeJoint="\u94F0\u63A5",a}({}),Qe={name:"\u666E\u901A\u8FDE\u63A5",connectType:W.HingeJoint,boltRadius:0,boltMetallic:"Q235A",metallicStandard:"GB/T 700 - 2006",connectMetallic:"Q235A",connectStandard:"GB/T 700 - 2006"},Fe={w1:.12,w2:.12},ze={w1:.12,w2:.12,t1:.01,t2:.01,t3:.01,t4:.01},Ge={Ro:.04},We={Ro:.04,Ri:.038},Je={w1:.05,t1:.003,w2:.05,t2:.003},Xe={w1:.075,t1:.011,w2:.2,t2:.009,w3:.075,t3:.011},$e={w1:.255,t1:.014,w2:.25,t2:.014,w3:.255,t3:.014},Z=function(a){return a.SquareSteel="\u65B9\u94A2",a.HollowSquareSteel="\u7A7A\u5FC3\u65B9\u94A2",a.RoundSteel="\u5706\u94A2",a.HollowRoundSteel="\u7A7A\u5FC3\u5706\u94A2",a.AngleSteel="\u89D2\u94A2",a.UShapedSteel="U\u5B57\u94A2",a.IBeamSteel="\u5DE5\u5B57\u94A2",a}({});function J(a){return a===Z.SquareSteel?Fe:a===Z.HollowSquareSteel?ze:a===Z.RoundSteel?Ge:a===Z.HollowRoundSteel?We:a===Z.AngleSteel?Je:a===Z.UShapedSteel?Xe:$e}var Ce={name:"\u666E\u901A\u6881",lineType:Z.SquareSteel,lineData:Fe,crossSection:"\u65B9\u94A2",angle:0,checkFormula:"\u7B2C\u4E00\u5957",boltMetallic:"Q235A",metallicStandard:"GB/T 700 - 2006",lengthCoefficient:1},De={depth:.1,D:.2},N=function(a){return a.NE="NE",a.NF="NF",a.NG="NG",a}({}),se={name:"\u666E\u901A\u57FA\u677F",planeType:N.NE,planeData:De,boltType:"M8",boltMetallic:"Q235A",metallicStandard:"GB/T 700 - 2006"};function pe(a){var n=a.userData;if(n.lineType!==Z.SquareSteel)throw new Error;var t=a.relyPoint1.position,r=a.relyPoint2.position,s=P.TE(t,r),o=n.lineData||J(n.lineType),l=T(o.w1,o.w2,s);return l}function Ye(a){var n=a.userData;if(n.lineType!==Z.HollowSquareSteel)throw new Error;var t=n.lineData||J(n.lineType),r=t.w1-t.t1-t.t2,s=t.w2-t.t3-t.t4;if(r<=0||s<=0)return pe(a);var o=a.relyPoint1.position,l=a.relyPoint2.position,d=P.TE(o,l),m=T(t.w1,t.w2,d),v=T(r,s,d);return p.vc(v.transform.matrix,[(t.t2-t.t1)/2,(t.t4-t.t3)/2,0]),u.yUD.subtract(m,v)}function Ke(a){var n=a.userData;if(n.lineType!==Z.RoundSteel)throw new Error;var t=a.relyPoint1.position,r=a.relyPoint2.position,s=P.TE(t,r),o=n.lineData||J(n.lineType),l=q(o.Ro,o.Ro,s);return l}function qe(a){var n=a.userData;if(n.lineType!==Z.HollowRoundSteel)throw new Error;var t=a.relyPoint1.position,r=a.relyPoint2.position,s=P.TE(t,r),o=n.lineData||J(n.lineType),l=q(o.Ro,o.Ro,s),d=q(o.Ri,o.Ri,s);return u.yUD.subtract(l,d)}function _e(a){var n=a.userData;if(n.lineType!==Z.AngleSteel)throw new Error;var t=n.lineData||J(n.lineType),r=t.w1-t.t2,s=t.w2-t.t1;if(r<=0||s<=0)return pe(a);var o=a.relyPoint1.position,l=a.relyPoint2.position,d=P.TE(o,l),m=T(t.w1,t.w2,d),v=T(r,s,d);return p.vc(v.transform.matrix,[-t.t2/2,t.t1/2,0]),u.yUD.subtract(m,v)}function et(a){var n=a.userData;if(n.lineType!==Z.UShapedSteel)throw new Error;var t=n.lineData||J(n.lineType),r=a.relyPoint1.position,s=a.relyPoint2.position,o=P.TE(r,s),l=T(t.w1,t.t1,o,1,1,1,p.vc(p.Ue(),[0,(t.t1-t.w2)/2,0])),d=T(t.t2,t.w2,o,1,1,1,p.vc(p.Ue(),[(t.t2-t.w1)/2,0,0])),m=T(t.w3,t.t3,o,1,1,1,p.vc(p.Ue(),[(t.w3-t.w1)/2,(t.w2-t.t3)/2,0]));return u.yUD.union(u.yUD.union(l,d),m)}function tt(a){var n=a.userData;if(n.lineType!==Z.IBeamSteel)throw new Error;var t=n.lineData||J(n.lineType),r=a.relyPoint1.position,s=a.relyPoint2.position,o=P.TE(r,s),l=T(t.w1,t.t1,o,1,1,1,p.vc(p.Ue(),[0,t.w2/2,0])),d=T(t.t2,t.w2,o),m=T(t.w3,t.t3,o,1,1,1,p.vc(p.Ue(),[0,-t.w2/2,0]));return u.yUD.union(u.yUD.union(l,d),m)}var X=1;function at(a){if(a.userData){var n;if(a.userData.lineType===Z.SquareSteel&&(n=pe(a),n.name="SquareSteel"+X),a.userData.lineType===Z.HollowSquareSteel&&(n=Ye(a),n.name="HollowSquareSteel"+X),a.userData.lineType===Z.RoundSteel&&(n=Ke(a),n.name="RoundSteel"+X),a.userData.lineType===Z.HollowRoundSteel&&(n=qe(a),n.name="HollowRoundSteel"+X),a.userData.lineType===Z.AngleSteel&&(n=_e(a),n.name="AngleSteel"+X),a.userData.lineType===Z.IBeamSteel&&(n=tt(a),n.name="IBeamSteel"+X),a.userData.lineType===Z.UShapedSteel&&(n=et(a),n.name="UShapedSteel"+X),X++,!n)throw new Error("\u672A\u77E5\u4E09\u7EF4\u6A21\u578B");var t=a.relyPoint1.position,r=a.relyPoint2.position,s=P.al((t[0]+r[0])/2,(t[1]+r[1])/2,(t[2]+r[2])/2);p.QO(n.transform.matrix,a.userData.angle||0),n.transform.matrix[12]=s[0],n.transform.matrix[13]=s[1],n.transform.matrix[14]=s[2];var o=P.$X(P.Ue(),t,r),l=P.al(0,0,1);return p.U1(n.transform.matrix,n.transform.matrix,-P.EU(o,l),P.kC(P.Ue(),o,l)),n}}function nt(a){var n=a.userData;if(n.planeType!==N.NE)throw new Error;var t=n.planeData||se,r=T(a.drawableParams.height,a.drawableParams.width,t.depth),s=q(t.D,t.D,t.depth*2);return p.vc(s.transform.matrix,[a.drawableParams.height/4,0,0]),r=u.yUD.subtract(r,s),p.vc(s.transform.matrix,[-a.drawableParams.height/4,0,0]),u.yUD.subtract(r,s)}function rt(a){var n=a.userData,t=n.planeData||se,r=T(a.drawableParams.height,a.drawableParams.width,t.depth),s=q(t.D,t.D,t.depth*2);return p.vc(s.transform.matrix,[a.drawableParams.height/4,a.drawableParams.width/4,0]),r=u.yUD.subtract(r,s),p.vc(s.transform.matrix,[-a.drawableParams.height/4,a.drawableParams.width/4,0]),r=u.yUD.subtract(r,s),p.vc(s.transform.matrix,[a.drawableParams.height/4,-a.drawableParams.width/4,0]),r=u.yUD.subtract(r,s),p.vc(s.transform.matrix,[-a.drawableParams.height/4,-a.drawableParams.width/4,0]),r=u.yUD.subtract(r,s),u.yUD.subtract(r,s)}var Ze=1;function it(a){if(a.userData){var n;if(a.userData.planeType===N.NE?(n=nt(a),n.name="NE"+Ze):(n=rt(a),n.name="NF"+Ze),Ze++,!n)throw new Error("\u672A\u77E5\u4E09\u7EF4\u6A21\u578B");return p.aC(n.transform.matrix,Math.PI/2),n}}var $=h(46670),e=h(38295),Q=h(87934),z=h(61952),st=new u.JOQ([0,1,0]),lt=new u.JOQ([0,0,1]),ot=new u.JOQ([1,0,0]),me=Re();function ut(){return e.Z.basePlane===z.W.x?st:e.Z.basePlane===z.W.y?lt:ot}function Ee(){return e.Z.basePlane===z.W.x&&(me.transform.matrix=p.aC(p.Ue(),Math.PI/2)),e.Z.basePlane===z.W.y&&(me.transform.matrix=p.Ue()),e.Z.basePlane===z.W.z&&(me.transform.matrix=p.gT(p.Ue(),Math.PI/2)),e.Z.baseRenderPass.model.update(),me}var _=h(31437);function ta(a){for(var n=0;n<a.height;n++)for(var t=0;t<a.width;t++){var r=a.width*(a.height-n-1)*4+t*4;a.data[r+3]=255}}function V(a){return _.al(a.offsetX*e.Z.dpr,a.offsetY*e.Z.dpr)}function dt(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=new u.aFS(e.Z.camera.builtInUniforms),t=new u.kBf;return t.expandByPartGroup(e.Z.baseRenderPass.model),t.setAbsMax(),t.scale(1.3),n.home(t),e.Z.camera.range.copy(n.range),n}function ct(a){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=new u.aFS(e.Z.camera.builtInUniforms),r=new u.kBf;return r.expandByPartGroup(e.Z.baseRenderPass.model),r.setAbsMax(),r.scale(1.5),t.lookFrom(a,r),e.Z.locator.onUniformChanged(),e.Z.camera.range.copy(t.range),t}function le(a){var n=_.Ue(),t=e.Z.canvas,r=t.clientWidth,s=t.clientHeight;n[0]=a.offsetX/r*2-1,n[1]=-(a.offsetY/s)*2+1,e.Z.ray.setFromCamera(n,e.Z.camera);var o=P.Ue();return e.Z.ray.intersectPlane(ut(),o),o}var mt=function(){function a(n){k()(this,a),b()(this,"dpr",1),b()(this,"isShift",!1),b()(this,"isOrbit",!1),b()(this,"scene",void 0),b()(this,"scenetree",e.Z.sceneTree),b()(this,"setKeyDown",this.keydown.bind(this)),b()(this,"setKeyUp",this.keyup.bind(this)),b()(this,"setMouseDown",this.mousedown.bind(this)),b()(this,"setMouseMove",this.mousemove.bind(this)),b()(this,"setMouseUp",this.mouseup.bind(this)),b()(this,"setWheel",this.wheel.bind(this)),this.scene=n,this.init()}return H()(a,[{key:"init",value:function(){var t=this;window.addEventListener("keydown",this.setKeyDown,!1),window.addEventListener("keyup",this.setKeyUp,!1),e.Z.canvas.addEventListener("mousedown",this.setMouseDown,!1),e.Z.canvas.addEventListener("mousemove",this.setMouseMove,!1),e.Z.canvas.addEventListener("mouseup",this.setMouseUp,!1),e.Z.canvas.addEventListener("wheel",this.setWheel,!1),window.oncontextmenu=function(r){r.preventDefault()},window.addEventListener("resize",function(){xe(t.scene)},!1)}},{key:"keydown",value:function(t){t.key==="Shift"&&(this.isShift=!0)}},{key:"keyup",value:function(t){t.key==="Shift"&&(this.isShift=!1)}},{key:"mousedown",value:function(t){var r=_.al(t.offsetX*this.dpr,t.offsetY*this.dpr);t.button===1?(e.Z.selectorExt.clearHinted(),this.isShift?e.Z.mouseHandler.begin("pan",r):e.Z.mouseHandler.begin("orbit",r),this.isOrbit=!0):(e.Z.rightClickMenuVisible&&(e.Z.updateRightClickMenuVisible(!1),e.Z.updateSelectedPart(null)),e.Z.machine.getNowState().mouseDown(t))}},{key:"mousemove",value:function(t){var r=_.al(t.offsetX*this.dpr,t.offsetY*this.dpr);e.Z.mouseHandler.move(r),e.Z.mouseHandler.action&&e.Z.coord.rotate(e.Z.camera.builtInUniforms.viewMatrix),this.isOrbit===!1&&e.Z.machine.getNowState().mouseMove(t)}},{key:"mouseup",value:function(t){var r=_.al(t.offsetX*this.dpr,t.offsetY*this.dpr);e.Z.mouseHandler.end(r),t.button===1?(e.Z.locator.visible?e.Z.locator.onMouseUp():e.Z.selectorExt.updateTexture(),this.isOrbit=!1):e.Z.machine.getNowState().mouseUp(t)}},{key:"wheel",value:function(t){var r=new u.BoW(e.Z.camera.builtInUniforms),s=_.al(t.offsetX*this.dpr,t.offsetY*this.dpr);r.update(s,t.deltaY<0?1.1:1/1.1),this.scene.render(),e.Z.selectorExt.onWheel(),e.Z.locator.onWheel()}},{key:"dispose",value:function(){window.removeEventListener("keydown",this.setKeyDown,!1)}}]),a}(),aa=h(37572);function xe(a){var n=document.getElementById("ys3d-root"),t=n.clientWidth,r=n.clientHeight;n.width=t,n.height=r,a.size=[n.width,n.height],e.Z.baseRenderPass.camera.builtInUniforms.viewportSize=[n.width,n.height],e.Z.coord.initCamera(a.size);var s=40,o=[a.size[0]/2-100,a.size[1]/2-100];e.Z.coord.scale=s,e.Z.coord.position=o,e.Z.coord.rotate(e.Z.camera.builtInUniforms.viewMatrix),e.Z.selectorExt.onSizeChanged(),e.Z.locator.onUniformChanged(),a.render()}function ht(){var a=Ae(),n=Ve(),t=Ee(),r=e.Z.baseRenderPass.model;r.add(a),r.add(n),r.add(t),r.update()}var na=h(29053),vt=h(64599),ft=h.n(vt),pt=h(15009),he=h.n(pt),Zt=h(99289),Ie=h.n(Zt),c=h(91993),be=h(95439),G=h(71577),xt=h(67040),F=function(a){return a.createPoint="\u7ED8\u5236\u8282\u70B9",a.createLine="\u7ED8\u5236\u6881",a.createPlane="\u7ED8\u5236\u57FA\u677F",a.selectMove="\u9009\u62E9\u62D6\u62FD\u79FB\u52A8",a.selectInfo="\u7F16\u8F91\u4FE1\u606F",a.selectConstraintUnits="\u9009\u62E9\u7EA6\u675F\u5355\u5143",a.none="\u7A7A\u72B6\u6001",a}({}),ee=function(){function a(n,t){k()(this,a),b()(this,"m_state",F.none),b()(this,"machine",void 0),this.state=n,this.machine=t}return H()(a,[{key:"state",get:function(){return this.m_state},set:function(t){this.m_state=t}},{key:"render",value:function(){e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render()}}]),a}(),bt=h(31996),te=h.n(bt),gt=h(26037),ae=h.n(gt),wt=function(a){te()(t,a);var n=ae()(t);function t(r){return k()(this,t),n.call(this,F.selectInfo,r)}return H()(t,[{key:"mouseDown",value:function(s){return this}},{key:"mouseMove",value:function(s){var o=V(s);return e.Z.selectorExt.showHint(o)&&this.machine.scene.render(),this}},{key:"mouseUp",value:function(s){if(e.Z.editPointFromVisible||e.Z.editLineFromVisible||e.Z.editQuadFromVisible)return this;var o=V(s),l=e.Z.selectorExt.hitTest(o);return e.Z.updateSelectedPart(l),e.Z.rightClickMenuVisible?(e.Z.updateRightClickMenuVisible(!1),e.Z.updateSelectedPart(null)):l&&(e.Z.setMenuXY(s.x,s.y),e.Z.updateRightClickMenuVisible(!0)),this}},{key:"enable",value:function(){return e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render(),this}},{key:"disable",value:function(){return this}}]),t}(ee),yt=h(25098),O=h.n(yt),oe=h(22319),St=function(a){te()(t,a);var n=ae()(t);function t(r){var s;return k()(this,t),s=n.call(this,F.selectMove,r),b()(O()(s),"movePointOperation",void 0),b()(O()(s),"filter",function(o){return o.name==="CadPoint"}),b()(O()(s),"isMove",!1),s}return H()(t,[{key:"mouseDown",value:function(s){if(s.button===0&&e.Z.locator.visible){var o=V(s);this.isMove=e.Z.locator.onMouseDown(o),this.movePointOperation=new oe._I(e.Z.locator.connectingPart)}return this}},{key:"mouseMove",value:function(s){var o=V(s);if(e.Z.locator.visible){e.Z.locator.onMouseMove(o),this.isMove&&e.Z.selectorExt.updateTexture();var l=e.Z.constraintGraphics[0],d=e.Z.constraintGraphics[1];e.Z.testConstraintSolver.updatePointsBuffer(),e.Z.testConstraintSolver.updateOtherBuffers(),e.Z.testConstraintSolver.solve(),l.setPosition(l.position),d.setPosition(d.position)}else e.Z.selectorExt.showHint(o);return e.Z.baseRenderPass.model.update(),this.machine.scene.render(),this}},{key:"mouseUp",value:function(s){var o=V(s);if(s.button===0){if(e.Z.locator.visible)e.Z.locator.onMouseUp(),e.Z.operationStack.execute(this.movePointOperation);else{e.Z.selectorExt.clearAll();var l=e.Z.selectorExt.hitTest(o);l&&l.name==="CadPoint"&&(e.Z.locator.setPart(l),this.machine.scene.render())}this.movePointOperation=void 0}return s.button===2&&e.Z.locator.visible&&(e.Z.locator.setVisible(!1),e.Z.selectorExt.clearAll(),e.Z.baseRenderPass.model.update(),e.Z.selectorExt.updateTexture(!0),this.machine.scene.render()),this.isMove=!1,this}},{key:"enable",value:function(){return e.Z.selectorExt.setFilter(this.filter),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render(),this}},{key:"disable",value:function(){return e.Z.selectorExt.setFilter(null),this.machine.selectInfo}}]),t}(ee),Pt=function(a){te()(t,a);var n=ae()(t);function t(r){return k()(this,t),n.call(this,F.selectConstraintUnits,r)}return H()(t,[{key:"mouseDown",value:function(s){return this}},{key:"mouseMove",value:function(s){var o=V(s);return e.Z.selectorExt.showHint(o)&&this.machine.scene.render(),this}},{key:"mouseUp",value:function(s){var o;if(e.Z.editPointFromVisible||e.Z.editLineFromVisible||e.Z.editQuadFromVisible)return this;var l=V(s),d=e.Z.selectorExt.hitTest(l);return!d||d.name!=="CadPoint"||d.topologyIndex===((o=e.Z.constraintGraphics[0])===null||o===void 0?void 0:o.topologyIndex)?this:(e.Z.addConstraintGraphics(d),this)}},{key:"enable",value:function(){return e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render(),this}},{key:"disable",value:function(){return this}}]),t}(ee),Ft=function(a){te()(t,a);var n=ae()(t);function t(r){return k()(this,t),n.call(this,F.createPoint,r)}return H()(t,[{key:"mouseDown",value:function(s){return this}},{key:"mouseMove",value:function(s){return this}},{key:"mouseUp",value:function(s){return s.button===0&&((0,Q.Qd)(le(s)),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render()),s.button===2&&this.machine.selectInfo.mouseUp(s),this}},{key:"enable",value:function(){return this}},{key:"disable",value:function(){return this.machine.selectInfo}}]),t}(ee),Ct=function(a){te()(t,a);var n=ae()(t);function t(r){var s;return k()(this,t),s=n.call(this,F.createLine,r),b()(O()(s),"lineHeap",null),b()(O()(s),"lineCompositeOperation",void 0),b()(O()(s),"operations",[]),b()(O()(s),"filter",function(o){return o.name==="CadPoint"}),s.operations=[],s.lineCompositeOperation=new oe.In(s.operations),s}return H()(t,[{key:"mouseDown",value:function(s){return this}},{key:"mouseMove",value:function(s){var o=V(s),l=e.Z.selectorExt.showHint(o);if(l&&this.machine.scene.render(),this.lineHeap){var d=e.Z.selectorExt.hitTest(o);if(d&&d.name==="CadPoint")e.Z.pointHeap.setPosition(d.position);else{var m=le(s);e.Z.pointHeap.setPosition(m)}this.lineHeap.geometry.updateRelyPoint(),this.machine.scene.render()}return this}},{key:"mouseUp",value:function(s){if(s.button===2)return this.lineHeap?this.cancel():this.machine.selectInfo.mouseUp(s),this;var o=V(s),l=le(s),d=e.Z.baseRenderPass.model,m=e.Z.sceneTree,v=e.Z.selectorExt.hitTest(o);if(this.lineHeap){if(e.Z.pointHeap.visible=!1,v&&v.name==="CadPoint")this.lineHeap.relyPoint2=v;else{var g=(0,Q.Qd)(e.Z.pointHeap.position,void 0,this.operations,this.lineCompositeOperation);this.lineHeap.relyPoint2=g}m.addNode(this.lineHeap),this.lineHeap=null,this.operations=[],this.lineCompositeOperation=new oe.In(this.operations)}else{var f;v&&v.name==="CadPoint"?f=v:f=(0,Q.Qd)(l,void 0,this.operations,this.lineCompositeOperation);var x=(0,Q.pS)(f,e.Z.pointHeap,void 0,this.operations,this.lineCompositeOperation);this.lineHeap=x,e.Z.pointHeap.visible=!0;var w=le(s);e.Z.pointHeap.setPosition(w)}return e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render(),this}},{key:"cancel",value:function(){this.lineHeap&&((0,Q.ws)(this.lineHeap,e.Z.baseRenderPass.model,e.Z.sceneTree),this.lineHeap=null,e.Z.pointHeap.visible=!1,e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render())}},{key:"enable",value:function(){return e.Z.selectorExt.setFilter(this.filter),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render(),this}},{key:"disable",value:function(){return this.cancel(),e.Z.selectorExt.setFilter(null),this.machine.selectInfo}}]),t}(ee),Dt=function(a){te()(t,a);var n=ae()(t);function t(r){var s;return k()(this,t),s=n.call(this,F.createPlane,r),b()(O()(s),"planeCompositeOperation",void 0),b()(O()(s),"operations",[]),b()(O()(s),"filter",function(o){return o.name==="CadPoint"}),s.operations=[],s.planeCompositeOperation=new oe.In(s.operations),s}return H()(t,[{key:"mouseDown",value:function(s){return this}},{key:"mouseMove",value:function(s){if(e.Z.quadHeap)return this;var o=V(s);return e.Z.selectorExt.showHint(o)&&this.machine.scene.render(),this}},{key:"mouseUp",value:function(s){if(e.Z.quadHeap)return this;if(s.button===2)return this.machine.selectInfo.mouseUp(s),this;var o=V(s);return(0,Q.hI)(le(s),e.Z.selectorExt.hitTest(o),this.operations,this.planeCompositeOperation),e.Z.updateQuadFromVisible(!0),this.machine.scene.render(),this.operations=[],this.planeCompositeOperation=new oe.In(this.operations),this}},{key:"cancel",value:function(){e.Z.quadHeap&&((0,Q.ws)(e.Z.quadHeap,e.Z.baseRenderPass.model,e.Z.sceneTree),e.Z.updateQuadHeap(null),e.Z.updateQuadFromVisible(!1))}},{key:"enable",value:function(){return e.Z.selectorExt.setFilter(this.filter),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),this.machine.scene.render(),this}},{key:"disable",value:function(){return this.cancel(),e.Z.selectorExt.setFilter(null),this.machine.selectInfo}}]),t}(ee),Et=function(){function a(n){k()(this,a),b()(this,"createPoint",void 0),b()(this,"createLine",void 0),b()(this,"createPlane",void 0),b()(this,"selectInfo",void 0),b()(this,"selectMove",void 0),b()(this,"selectConstraintUnits",void 0),b()(this,"m_nowState",void 0),b()(this,"scene",void 0),this.scene=n,this.selectInfo=new wt(this),this.selectMove=new St(this),this.createPoint=new Ft(this),this.createLine=new Ct(this),this.createPlane=new Dt(this),this.selectConstraintUnits=new Pt(this),this.m_nowState=this.selectInfo}return H()(a,[{key:"getNowState",value:function(){return this.m_nowState}},{key:"setNowState",value:function(t){return this.m_nowState=this.m_nowState.disable(),t===F.createPoint?this.m_nowState=this.createPoint:t===F.createLine?this.m_nowState=this.createLine:t===F.createPlane?this.m_nowState=this.createPlane:t===F.selectMove?this.m_nowState=this.selectMove:t===F.selectInfo?this.m_nowState=this.selectInfo:t===F.selectConstraintUnits&&(this.m_nowState=this.selectConstraintUnits),this.m_nowState.enable(),this.m_nowState}}]),a}(),y=h(2831),i=h(85893),It=function(n){var t=n.scene,r=c.Z.useForm(),s=A()(r,1),o=s[0],l={n_x:0,n_y:1,n_z:0,length:8,width:4,angle:0},d=function(){if(!e.Z.quadHeap)throw new Error("\u9762\u7F13\u5B58\u4E3A\u7A7A");var v=o.getFieldsValue(),g=P.al(0,1,0),f=P.al(v.x,v.y,v.z);P.fS(f,P.Ue())?P.JG(g,P.al(0,1,0)):P.Fv(g,f),e.Z.quadHeap.update(g,v.angle,v.length,v.width);var x=e.Z.baseRenderPass.model;e.Z.quadHeap.visible=!0,x.update(),e.Z.updateQuadHeap(),e.Z.selectorExt.clearAll(),e.Z.updateQuadFromVisible(!1),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),t.render()};return(0,i.jsx)("div",{style:{position:"fixed",width:"15vw",right:"0px",backgroundColor:"#FCFCFC",pointerEvents:"auto"},children:(0,i.jsxs)(c.Z,{name:"plane",form:o,style:{width:"10vw",marginLeft:"30px",backgroundColor:"#FCFCFC"},children:[(0,i.jsx)(c.Z.Item,{label:"\u57FA\u677F",children:(0,i.jsx)("span",{children:"\u6CD5\u7EBF\u503C"})}),(0,i.jsx)(c.Z.Item,{label:"x",name:"x",initialValue:l.n_x,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"y",name:"y",initialValue:l.n_y,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"z",name:"z",initialValue:l.n_z,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u957F\u5EA6",name:"length",initialValue:l.length,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u5BBD\u5EA6",name:"width",initialValue:l.width,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u89D2\u5EA6 \xB0",name:"angle",initialValue:l.angle,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{type:"primary",htmlType:"submit",onClick:d,children:"\u786E\u5B9A"})})]})})},jt=(0,$.Pi)(It),je=h(90980),Tt=function(n){var t=n.scene,r=function(l){var d=l.key;if(e.Z.selectedPart)switch(d){case"delete":(0,Q.d_)(e.Z.selectedPart,e.Z.baseRenderPass.model,e.Z.sceneTree),t.render();break;case"edit":e.Z.selectedPart.name==="CadPoint"?e.Z.updateEditPointFromVisible(!0):e.Z.selectedPart.name==="CadLine"?e.Z.updateEditLineFromVisible(!0):e.Z.selectedPart.name==="CadQuad"&&e.Z.updateEditQuadFromVisible(!0);break;case"hide":break;case"focus":break;default:break}},s=[{key:"delete",label:"\u5220\u9664",selectable:!0},{key:"edit",label:"\u7F16\u8F91",selectable:!0},{key:"hide",label:"\u9690\u85CF",selectable:!1},{key:"focus",label:"\u805A\u7126",selectable:!1}];return(0,i.jsx)(je.Z,{style:{position:"fixed",left:"".concat(e.Z.menuX,"px"),top:"".concat(e.Z.menuY,"px"),display:"block",pointerEvents:"auto"},onClick:function(){return e.Z.updateRightClickMenuVisible(!1)},children:s.map(function(o){return(0,i.jsx)(je.Z.Item,{onClick:r,disabled:!o.selectable,children:o.label},o.key)})})},Mt=(0,$.Pi)(Tt),Ut=h(14444),At=function(n){var t=n.scene,r=e.Z.sceneTree.treeData,s=(0,L.useState)(r),o=A()(s,2),l=o[0],d=o[1];e.Z.sceneTree.updateTreeData(d);var m=function(g,f){if(f.node){var x=f.node.title.split("-")[0];if(x==="CadPoint"){var w=e.Z.sceneTree.pointMap.get(f.node.title);e.Z.updateSelectedPart(w),e.Z.updateEditPointFromVisible(!0),e.Z.updateEditLineFromVisible(!1),e.Z.updateEditQuadFromVisible(!1)}else if(x==="CadLine"){var M=e.Z.sceneTree.lineMap.get(f.node.title);e.Z.updateSelectedPart(M),e.Z.updateEditLineFromVisible(!0),e.Z.updateEditPointFromVisible(!1),e.Z.updateEditQuadFromVisible(!1)}else if(x==="CadQuad"){var B=e.Z.sceneTree.quadMap.get(f.node.title);e.Z.updateSelectedPart(B),e.Z.updateEditQuadFromVisible(!0),e.Z.updateEditLineFromVisible(!1),e.Z.updateEditPointFromVisible(!1)}}};return(0,i.jsx)("div",{style:{width:"300px",pointerEvents:"auto"},children:(0,i.jsx)(Ut.Z,{style:{width:"300px"},checkable:!0,treeData:l,onSelect:m})})},Bt=(0,$.Pi)(At),Vt=h(97857),Te=h.n(Vt),ue=h(56760),Rt=function(n){var t=n.scene,r=c.Z.useForm(),s=A()(r,1),o=s[0],l=e.Z.selectedPart,d=l.topologyIndex,m=l.position[0],v=l.position[1],g=l.position[2],f=(0,L.useState)(l.userData||Qe),x=A()(f,2),w=x[0],M=x[1],B=function(I){M(Te()(Te()({},w),{},{connectType:I}))},E=function(){var I=o.getFieldsValue(),re=P.al(I.x,I.y,I.z);e.Z.selectedPart.setPosition(re);var U=e.Z.baseRenderPass.model;U.update(),l.userData={name:I.name,connectType:I.connectType,boltRadius:I.boltRadius,boltMetallic:I.boltMetallic,metallicStandard:I.metallicStandard,connectMetallic:I.connectMetallic,connectStandard:I.connectStandard},e.Z.updateEditPointFromVisible(!1),e.Z.sceneTree.UpdateTreeUserDate(l.name,l.topologyIndex,l.userData)};return(0,i.jsx)("div",{style:{position:"fixed",width:"15vw",minWidth:"260px",right:"0px",backgroundColor:"#FCFCFC",pointerEvents:"auto"},children:(0,i.jsxs)(c.Z,{name:"\u7F16\u8F91\u70B9",form:o,style:{width:"15vw",marginLeft:"30px",backgroundColor:"#FCFCFC"},children:[(0,i.jsx)(c.Z.Item,{label:"\u8282\u70B9\u7F16\u8F91",name:"\u8282\u70B9\u7F16\u8F91",initialValue:"\u8282\u70B9\u7F16\u8F91",children:(0,i.jsx)("span",{style:{marginLeft:"40px",fontSize:"14pt"},children:"\u8282\u70B9\u7F16\u8F91"})}),(0,i.jsx)(c.Z.Item,{label:"\u8282\u70B9\u5E8F\u53F7",name:"pointID",initialValue:d,children:(0,i.jsx)("span",{style:{marginLeft:"20px"},children:d})}),(0,i.jsx)(c.Z.Item,{label:"\u8282\u70B9\u540D\u79F0",name:"name",initialValue:w.name,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"x\u5750\u6807",name:"x",initialValue:m,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"y\u5750\u6807",name:"y",initialValue:v,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"z\u5750\u6807",name:"z",initialValue:g,children:(0,i.jsx)(y.Z,{type:"text"})}),l.associatedPart.size>1?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z.Item,{label:"\u8FDE\u63A5\u540D\u79F0",name:"ConnectType",initialValue:w.connectType,children:(0,i.jsx)(ue.Z,{style:{width:120},onChange:B,options:[{value:W.HingeJoint,label:W.HingeJoint},{value:W.CornerBolted,label:W.CornerBolted},{value:W.PlateBolted,label:W.PlateBolted}]})}),w.connectType!==W.HingeJoint&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z.Item,{label:"\u87BA\u6813\u534A\u5F84",name:"boltRadius",initialValue:w.boltRadius,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u87BA\u6813\u6750\u6599",name:"boltMetallic",initialValue:w.boltMetallic,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u6750\u6599\u89C4\u8303",name:"metallicStandard",initialValue:w.metallicStandard,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:w.connectType+"\u6750\u6599",name:"connectMetallic",initialValue:w.connectMetallic,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:w.connectType+"\u89C4\u8303",name:"connectStandard",initialValue:w.connectStandard,children:(0,i.jsx)(y.Z,{type:"text"})})]})]}):(0,i.jsx)(i.Fragment,{}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{type:"primary",htmlType:"submit",onClick:E,children:"\u786E\u5B9A"})})]})})},kt=(0,$.Pi)(Rt),ra=ue.Z.Option,Ht=function(n){var t=n.scene,r=c.Z.useForm(),s=A()(r,1),o=s[0],l=e.Z.selectedPart,d=l.topologyIndex,m=l.m_point1.topologyIndex,v=l.m_point2.topologyIndex,g=(0,L.useState)(l.userData||Ce),f=A()(g,2),x=f[0],w=f[1],M=function(){var E=o.getFieldsValue();l.userData={name:E.name,lineType:E.lineType,lineData:J(E.lineType),crossSection:E.crossSection,angle:E.angle,checkFormula:E.checkFormula,boltMetallic:E.boltMetallic,metallicStandard:E.metallicStandard,lengthCoefficient:E.lengthCoefficient},e.Z.updateEditLineFromVisible(!1),e.Z.sceneTree.UpdateTreeUserDate(l.name,l.topologyIndex,l.userData)};return(0,i.jsx)("div",{style:{position:"fixed",width:"15vw",minWidth:"350px",right:"0px",backgroundColor:"#FCFCFC",pointerEvents:"auto"},children:(0,i.jsxs)(c.Z,{name:"\u7F16\u8F91\u6881",form:o,style:{width:"30vw",marginLeft:"30px",backgroundColor:"#FCFCFC"},children:[(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)("span",{style:{marginLeft:"40px",fontSize:"14pt"},children:"\u6881\u7F16\u8F91"})}),(0,i.jsx)(c.Z.Item,{label:"\u6881\u7D22\u5F15",name:"lineID",initialValue:d,children:(0,i.jsx)("span",{style:{marginLeft:"20px"},children:d})}),(0,i.jsx)(c.Z.Item,{label:"\u6881\u540D\u79F0",name:"name",initialValue:x.name,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u7AEF\u70B91",name:"point1",children:(0,i.jsx)("span",{style:{marginLeft:"20px"},children:m})}),(0,i.jsx)(c.Z.Item,{label:"\u7AEF\u70B92",name:"point2",children:(0,i.jsx)("span",{style:{marginLeft:"20px"},children:v})}),(0,i.jsx)(c.Z.Item,{label:"\u622A\u9762\u7C7B\u578B",name:"lineType",initialValue:x.lineType,children:(0,i.jsx)(ue.Z,{style:{width:120},options:[{value:Z.AngleSteel,label:Z.AngleSteel},{value:Z.HollowRoundSteel,label:Z.HollowRoundSteel},{value:Z.HollowSquareSteel,label:Z.HollowSquareSteel},{value:Z.IBeamSteel,label:Z.IBeamSteel},{value:Z.RoundSteel,label:Z.RoundSteel},{value:Z.SquareSteel,label:Z.SquareSteel},{value:Z.UShapedSteel,label:Z.UShapedSteel}]})}),(0,i.jsx)(c.Z.Item,{label:"\u622A\u9762",name:"crossSection",initialValue:x.crossSection,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u89D2\u5EA6",name:"angle",initialValue:x.angle,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u6821\u6838\u516C\u5F0F",name:"checkFormula",initialValue:x.checkFormula,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u6750\u6599",name:"boltMetallic",initialValue:x.boltMetallic,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u6750\u6599\u89C4\u8303",name:"metallicStandard",initialValue:x.metallicStandard,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u957F\u5EA6\u7CFB\u6570",name:"lengthCoefficient",initialValue:x.lengthCoefficient,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{type:"primary",htmlType:"submit",onClick:M,children:"\u786E\u5B9A"})})]})})},Ot=(0,$.Pi)(Ht),Lt=h(27918),ia=ue.Z.Option,Nt=function(n){var t=n.scene,r=c.Z.useForm(),s=A()(r,1),o=s[0],l,d,m,v,g,f,x;(0,Lt.Z)(function(){l=e.Z.selectedPart,d=l.topologyIndex,m=l.relyPoint.topologyIndex,v=l.drawableParams.planeNormal,g=l.drawableParams.height,f=l.drawableParams.width,x=l.drawableParams.angle},[]);var w=(0,L.useState)(l.userData||se),M=A()(w,2),B=M[0],E=M[1],de=function(){var I=Ie()(he()().mark(function re(){var U,ve;return he()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:U=o.getFieldsValue(),U.boltMetallic!==se.boltMetallic&&(ve=u.yUD.subtract(T(10,1,10),q(2,2,10)),l.addDrawable(ve)),l.update(v,Number(U.ori_angle),Number(U.ori_length),Number(U.ori_width)),e.Z.baseRenderPass.model.update(),l.userData={name:U.name,planeType:U.planeType,planeData:De,boltType:U.boltType,boltMetallic:U.boltMetallic,metallicStandard:U.metallicStandard},e.Z.updateEditQuadFromVisible(!1),e.Z.sceneTree.UpdateTreeUserDate(l.name,l.topologyIndex,l.userData),t.render();case 8:case"end":return ce.stop()}},re)}));return function(){return I.apply(this,arguments)}}();return(0,i.jsx)("div",{style:{position:"fixed",width:"15vw",minWidth:"260px",right:"0px",backgroundColor:"#FCFCFC",pointerEvents:"auto"},children:(0,i.jsxs)(c.Z,{name:"\u7F16\u8F91\u57FA\u677F",form:o,style:{minWidth:"15vw",marginLeft:"15px",backgroundColor:"#FCFCFC"},children:[(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)("span",{style:{marginLeft:"40px",fontSize:"14pt"},children:"\u57FA\u677F\u7F16\u8F91"})}),(0,i.jsx)(c.Z.Item,{label:"\u57FA\u677F\u5E8F\u53F7",name:"planeID",initialValue:d,children:(0,i.jsx)("span",{style:{marginLeft:"20px"},children:d})}),(0,i.jsx)(c.Z.Item,{label:"\u57FA\u677F\u540D\u79F0",name:"name",initialValue:B.name,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u5173\u8054\u8282\u70B9",name:"pointID",initialValue:m,children:(0,i.jsx)("span",{style:{marginLeft:"20px"},children:m})}),(0,i.jsx)(c.Z.Item,{label:"\u57FA\u677F\u7C7B\u578B",name:"planeType",initialValue:B.planeType,children:(0,i.jsx)(ue.Z,{style:{width:120},options:[{value:N.NE,label:N.NE},{value:N.NF,label:N.NF},{value:N.NG,label:N.NG}]})}),(0,i.jsx)(c.Z.Item,{label:"\u957F\u5EA6",name:"ori_length",initialValue:g,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u5BBD\u5EA6",name:"ori_width",initialValue:f,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u89D2\u5EA6 \xB0",name:"ori_angle",initialValue:x,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u87BA\u6813\u578B\u53F7",name:"boltType",initialValue:B.boltType,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u6750\u6599",name:"boltMetallic",initialValue:B.boltMetallic,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{label:"\u6750\u6599\u89C4\u8303",name:"materialStand",initialValue:B.metallicStandard,children:(0,i.jsx)(y.Z,{type:"text"})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{type:"primary",htmlType:"submit",onClick:de,children:"\u786E\u5B9A"})})]})})},Qt=(0,$.Pi)(Nt),ne=function(a){return a.OneDimensional="\u4E00\u7EF4\u5C55\u793A",a.ThreeDimensional="\u4E09\u7EF4\u5C55\u793A",a}(ne||{}),zt=function(n){var t=n.scene,r=(0,L.useState)(F.selectInfo),s=A()(r,2),o=s[0],l=s[1],d=(0,L.useState)(!1),m=A()(d,2),v=m[0],g=m[1],f=(0,L.useState)(""),x=A()(f,2),w=x[0],M=x[1],B=function(C){e.Z.updateBasePlane(C),Ee();var j;C==="X"?j="y":C==="Y"?j="z":C==="Z"&&(j="x"),ct(j),e.Z.coord.rotate(e.Z.camera.builtInUniforms.viewMatrix),t.render()};function E(D){e.Z.selectorExt.clearAll(),e.Z.selectorExt.setFilter(null),e.Z.selectorExt.updateTexture(),e.Z.machine.setNowState(D),l(D),t.render()}function de(D){var C=D===ne.OneDimensional,j=D===ne.ThreeDimensional;E(F.selectInfo),u.fwJ(e.Z.baseRenderPass.model,function(S){S.visible&&(j&&(S.drawableThree&&S.drawableThree.dispose(),S.name==="CadLine"&&(S.userData||(S.userData=Ce),S.drawableThree=at(S)),S.name==="CadQuad"&&(S.userData||(S.userData=se),S.drawableThree=it(S))),S.changeDrawable&&S.changeDrawable(C,j))}),e.Z.baseRenderPass.model.update(),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model),e.Z.selectorExt.updateTexture(),t.render()}var I=function(){},re=function(){var C=JSON.stringify(e.Z.sceneTree.structureTree);ge(C,"scenetree")},U=function(){var C=JSON.stringify(e.Z.sceneTree.simulationData);ge(C,"scaffold_data")},ve=function(){},ge=function(C,j){var S=document.createElement("a");S.download=j+".json",S.style.display="none";var R=new Blob([C]);S.href=URL.createObjectURL(R),document.body.appendChild(S),S.click(),document.body.removeChild(S)},ce=function(){(0,Q.L3)(),e.Z.sceneTree.buildTreeByJson(JSON.parse(w)),g(!1)},Xt=function(){e.Z.sceneTree.buildTreeByJson(JSON.parse(w)),g(!1)},$t=function(){var D=Ie()(he()().mark(function C(j){var S,R;return he()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:try{S=j.target.files[0],R=new FileReader,R.onload=function(K){var we=K.target.result;M(JSON.stringify(JSON.parse(we))),g(!0)},R.readAsText(S)}catch(K){}case 1:case"end":return Y.stop()}},C)}));return function(j){return D.apply(this,arguments)}}(),Yt=function(){e.Z.operationStack.undo()},Kt=function(){e.Z.operationStack.redo()},qt=function(){var C=ft()(e.Z.baseRenderPass.model),j;try{for(C.s();!(j=C.n()).done;){var S=j.value;if(S.name==="graphicsGroup"){e.Z.testConstraintSolver.obj3d=S;break}}}catch(_t){C.e(_t)}finally{C.f()}var R=e.Z.constraintGraphics[0],ie=e.Z.constraintGraphics[1];if(!R||!ie){alert("\u8BF7\u5148\u9009\u62E9\u7EA6\u675F\u5355\u5143");return}e.Z.testConstraintSolver.linkedObjs.set(e.Z.testConstraintSolver.l_id,["line",["CadPoint-1","CadPoint-2","CadLine-1"]]);for(var Y=0,K=0;K<3;K++)Y+=Math.pow(R.position[K]-ie.position[K],2);Y=Math.sqrt(Y);var we=["pt_pt_distance",Y,[R.topologyIndex,ie.topologyIndex,-1,-1]];e.Z.testConstraintSolver.constraints.set(++e.Z.testConstraintSolver.c_id,we),e.Z.testConstraintSolver.updatePointsBuffer(),e.Z.testConstraintSolver.updateOtherBuffers(),e.Z.testConstraintSolver.solve(),R.setPosition(R.position),ie.setPosition(ie.position),t.render()};return(0,i.jsxs)("div",{style:{position:"absolute",zIndex:"1000",pointerEvents:"none"},children:[(0,i.jsxs)(c.Z,{name:"basic",style:{width:"80vw",pointerEvents:"auto"},initialValues:{remember:!0},autoComplete:"off",layout:"inline",children:[(0,i.jsx)(c.Z.Item,{label:"\u57FA\u51C6\u9762\u9009\u62E9",name:"BasePlane",children:(0,i.jsx)(be.Z,{defaultValue:z.W.x,options:[z.W.x,z.W.y,z.W.z],value:e.Z.basePlane,onChange:B})}),(0,i.jsx)(c.Z.Item,{label:"\u9009\u62E9\u529F\u80FD",name:"PointerState",children:(0,i.jsx)(be.Z,{options:[F.selectInfo,F.selectMove,F.selectConstraintUnits,F.createPoint,F.createLine,F.createPlane],value:o,onChange:E})}),(0,i.jsx)(c.Z.Item,{label:"\u663E\u793A\u6A21\u5F0F",name:"DisplayMode",children:(0,i.jsx)(be.Z,{defaultValue:ne.OneDimensional,options:[ne.OneDimensional,ne.ThreeDimensional],onChange:de})}),(0,i.jsx)(c.Z.Item,{name:"testConstraint",children:(0,i.jsx)(G.Z,{onClick:qt,children:"\u6D4B\u8BD5\u7EA6\u675F"})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{onClick:re,children:"\u5BFC\u51FA\u5F53\u524D\u573A\u666F"})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)("input",{type:"file",onChange:$t})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{onClick:ve,children:"\u5BFC\u51FA\u64CD\u4F5C\u8BB0\u5F55"})}),"\u6CE8\uFF1A\u9F20\u6807\u4E2D\u952E\u65CB\u8F6C\u63A7\u5236\u573A\u666F",(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{onClick:Yt,children:"\u64A4\u9500"})}),(0,i.jsx)(c.Z.Item,{children:(0,i.jsx)(G.Z,{onClick:Kt,children:"\u56DE\u64A4"})})]}),(0,i.jsx)(xt.Z,{title:"\u6E05\u9664\u573A\u666F\u56FE\u5143",open:v,onOk:ce,onCancel:Xt,children:(0,i.jsx)("p",{children:"\u662F\u5426\u6E05\u9664\u5F53\u524D\u573A\u666F\u4E2D\u7684\u7EC4\u4EF6"})}),e.Z.quadFromVisible&&(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(jt,{scene:t})}),e.Z.editPointFromVisible&&(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(kt,{scene:t})}),e.Z.editLineFromVisible&&(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(Ot,{scene:t})}),e.Z.editQuadFromVisible&&(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(Qt,{scene:t})}),e.Z.rightClickMenuVisible&&(0,i.jsx)("div",{style:{pointerEvents:"auto"},children:(0,i.jsx)(Mt,{scene:t})}),(0,i.jsx)(Bt,{scene:t})]})},Gt=(0,$.Pi)(zt),Wt=function(){var n=(0,L.useState)(new u.xsS(null)),t=A()(n,2),r=t[0],s=t[1];return(0,L.useEffect)(function(){e.Z.updateCanvas(document.getElementById("ys3d-root"));var o=e.Z.canvas.getContext("webgl",{stencil:!1}),l=new u.V1M(o);r.renderContext=l,ht(),r.push(e.Z.baseRenderPass);var d=new u.JJg;d.name="graphicsGroup",e.Z.baseRenderPass.model.addPart(d);var m=e.Z.baseRenderPass.camera.builtInUniforms;m.viewportSize=[e.Z.canvas.width,e.Z.canvas.height],e.Z.updateCamera(e.Z.baseRenderPass.camera),e.Z.updateSelectorExt(new u.e1z(m)),e.Z.selectorExt.devFilter=function(x){return x.selectable},e.Z.updateCoord(new u.VoV([e.Z.canvas.width,e.Z.canvas.height],[50,50],50)),r.push(e.Z.coord.renderPass),r.push(e.Z.selectorExt.getIdRenderPass()),r.push(e.Z.selectorExt.getSelectRenderPass()),r.push(e.Z.selectorExt.getHintRenderPass()),e.Z.selectorExt.setModel(e.Z.baseRenderPass.model);var v=new u.vhI(m);v.setVisible(!1),e.Z.updateLocator(v),r.push(v.renderPassGroup),e.Z.updateMouseHandler(new Ne(m)),e.Z.mouseHandler.render=function(){r.render()};var g=new Et(r);e.Z.updateMachine(g),dt(!0),e.Z.coord.rotate(m.viewMatrix);var f=new mt(r);xe(r),setTimeout(function(){xe(r)},1e3*.5)},[]),(0,i.jsxs)(i.Fragment,{children:[r&&(0,i.jsx)(Gt,{scene:r}),(0,i.jsx)("canvas",{id:"ys3d-root",style:{position:"absolute",left:"0",width:"100%",height:"100vh",zIndex:"100"}})]})},Jt=(0,$.Pi)(Wt)}}]);
